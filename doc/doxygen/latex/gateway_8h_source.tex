\doxysection{gateway.\+h}
\hypertarget{gateway_8h_source}{}\label{gateway_8h_source}\index{include/api/framework/gateway.h@{include/api/framework/gateway.h}}
\mbox{\hyperlink{gateway_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ GATEWAY\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ GATEWAY\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <unordered\_map>}}
\DoxyCodeLine{00005\ \textcolor{preprocessor}{\#include\ <unordered\_set>}}
\DoxyCodeLine{00006\ \textcolor{preprocessor}{\#include\ <pthread.h>}}
\DoxyCodeLine{00007\ \textcolor{preprocessor}{\#include\ <chrono>}}
\DoxyCodeLine{00008\ \textcolor{preprocessor}{\#include\ <sstream>}}
\DoxyCodeLine{00009\ }
\DoxyCodeLine{00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{traits_8h}{api/traits.h}}"{}}}
\DoxyCodeLine{00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{communicator_8h}{api/network/communicator.h}}"{}}}
\DoxyCodeLine{00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bus_8h}{api/network/bus.h}}"{}}}
\DoxyCodeLine{00013\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{network_8h}{api/framework/network.h}}"{}}}
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{csv__logger_8h}{api/util/csv\_logger.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{message_8h}{api/network/message.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{debug_8h}{api/util/debug.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_gateway_a2c1f64b1635c44121618ba9456302f9f}{Gateway}}\ \{}
\DoxyCodeLine{00019\ \ \ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00020\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_network_a638cca85e6d97e60e28b9bbb310aa1e2}{Network::Communicator}}\ \mbox{\hyperlink{class_gateway_a76edea483e2423073e893eceba9a0c92}{Communicator}};}
\DoxyCodeLine{00021\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_network_a8d0ff6afe275a422cb63a9eec75f8d4a}{Network::Protocol}}\ \mbox{\hyperlink{class_gateway_ac5412e35f863e71e02d5179f3996ff0d}{Protocol}};}
\DoxyCodeLine{00022\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ Protocol::Address\ \mbox{\hyperlink{class_gateway_a8870ecac85c6ef2130172409529f3e4b}{Address}};}
\DoxyCodeLine{00023\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_network_ace8ef437586a78c43b82d6d4b5ae6410}{Network::Message}}\ \mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}};}
\DoxyCodeLine{00024\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_message_adc63ad6ff6d68eb4f0c9a0c730bd5ab4}{Message::Unit}}\ \mbox{\hyperlink{class_gateway_af981fe90f3ace162953b3f5c52e87d1b}{Unit}};}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{class_c_a_n_a359d8413dfaf202bdaa027d33286fd4f}{CAN::Observer}}\ \mbox{\hyperlink{class_gateway_ab76a33c2110ad476a86c73ed4a265ceb}{Observer}};}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ std::unordered\_map<Unit,\ std::unordered\_set<Observer*>>\ \mbox{\hyperlink{class_gateway_ab6ce65b195618088cd9964104a130e94}{Map}};}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_gateway_ac0b94dec600bdd1c62d3e0cb70218b9d}{MAX\_MESSAGE\_SIZE}}\ =\ \mbox{\hyperlink{class_protocol_abb9a16075a603f1bb1fd353b30bfdd24}{Protocol::MTU}}\ -\/\ \textcolor{keyword}{sizeof}(Protocol::Header)\ -\/\ \textcolor{keyword}{sizeof}(Protocol::TimestampFields);}
\DoxyCodeLine{00029\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_gateway_a21819630f9a231d5640f3e8e43940932}{PORT}}\ =\ 0;}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_gateway_a2c1f64b1635c44121618ba9456302f9f}{Gateway}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id},\ \mbox{\hyperlink{class_network_a4b0f38eb75202f20638f1e096cb0852a}{Network::EntityType}}\ entity\_type\ =\ \mbox{\hyperlink{class_network_a4b0f38eb75202f20638f1e096cb0852aae9fa318f4d73c31493e98096efa497e2}{Network::EntityType::VEHICLE}});}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_gateway_a7a86ddccd1e942aa584a4e8c42f82e0b}{\string~Gateway}}();}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_gateway_ac2b912b4419b787d22cbf1044adc9b09}{start}}();}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_gateway_adce87b6d4437bf838a96d5c1f49fd00e}{send}}(\mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}*\ message);}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_gateway_a147a0d9f720175e22ff07a9d88062208}{receive}}(\mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}*\ msg);}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_gateway_ae214631a4279aa252fe047db0f3674d1}{internalReceive}}(\mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}*\ msg);}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_gateway_aa699d63a59873a2fd734ad1589d7bac3}{running}}()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{class_gateway_a457ea83a125378da10de5abd808fb84b}{mainloop}}(\textcolor{keywordtype}{void}*\ arg);}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{class_gateway_a3c27f9d6b08792b882f48d52abd96387}{internalLoop}}(\textcolor{keywordtype}{void}*\ arg);}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_gateway_a8870ecac85c6ef2130172409529f3e4b}{Address}}\&\ \mbox{\hyperlink{class_gateway_a0cfa8003cefbe287da06a97f6539cd1a}{address}}();}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_c_a_n}{CAN}}*\ \mbox{\hyperlink{class_gateway_adcfdc41879c428b4a0d15524f6e44638}{bus}}()\ \{\ \textcolor{keywordflow}{return}\ \_can;\ \}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ New\ method\ to\ access\ network\ for\ RSU\ manager\ setup}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_network}{Network}}*\ \mbox{\hyperlink{class_gateway_a3fc2f28569c2f73a542c743862f50559}{network}}()\ \{\ \textcolor{keywordflow}{return}\ \_network;\ \}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CSV\ logging\ methods}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_gateway_a64ff0b83488d7bf17ffc1bb9e439df87}{setup\_csv\_logging}}(\textcolor{keyword}{const}\ std::string\&\ log\_dir);}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_gateway_a20131aa2cc26d43572c8ac19629736ee}{log\_message}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_message}{Message}}\&\ msg,\ \textcolor{keyword}{const}\ std::string\&\ direction);}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ handle(\mbox{\hyperlink{class_message}{Message}}*\ msg);}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ subscribe(\mbox{\hyperlink{class_message}{Message}}*\ message);}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ publish(\mbox{\hyperlink{class_message}{Message}}*\ message);}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \_id;}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_network}{Network}}*\ \_network;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_communicator}{Communicator}}*\ \_comms;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_c_a_n}{CAN}}*\ \_can;}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_gateway_ab76a33c2110ad476a86c73ed4a265ceb}{Observer}}*\ \_can\_observer;}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ pthread\_t\ \_receive\_thread;}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ pthread\_t\ \_internal\_thread;}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ std::atomic<bool>\ \_running;}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ std::unique\_ptr<CSVLogger>\ \_csv\_logger;}
\DoxyCodeLine{00068\ \};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{comment}{/********\ Gateway\ Implementation\ ********/}}
\DoxyCodeLine{00071\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{class_gateway_a2c1f64b1635c44121618ba9456302f9f}{Gateway::Gateway}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \textcolor{keywordtype}{id},\ \mbox{\hyperlink{class_network_a4b0f38eb75202f20638f1e096cb0852a}{Network::EntityType}}\ entity\_type)\ :\ \_id(id),\ \_running(false)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a897a262bdd244180d7aba71cd004b747a067c599a4252b028fe5ee215b368df1c}{TRC}})\ <<\ \textcolor{stringliteral}{"{}Gateway::Gateway("{}}\ <<\ \textcolor{keywordtype}{id}\ <<\ \textcolor{stringliteral}{"{},\ entity\_type)\ called!\(\backslash\)n"{}};}
\DoxyCodeLine{00073\ \ \ \ \ \_network\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_network}{Network}}(\textcolor{keywordtype}{id},\ entity\_type);}
\DoxyCodeLine{00074\ \ \ \ \ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ Sets\ communicator}}
\DoxyCodeLine{00076\ \ \ \ \ \mbox{\hyperlink{class_gateway_a8870ecac85c6ef2130172409529f3e4b}{Address}}\ addr(\_network-\/>address(),\ \mbox{\hyperlink{class_gateway_a21819630f9a231d5640f3e8e43940932}{PORT}});}
\DoxyCodeLine{00077\ \ \ \ \ \_comms\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_gateway_a76edea483e2423073e893eceba9a0c92}{Communicator}}(\_network-\/>channel(),\ addr);}
\DoxyCodeLine{00078\ \ \ \ \ \_can\ =\ \_network-\/>bus();}
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{class_condition}{Condition}}\ c(0,\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a696b031073e74bf2cb98e5ef201d4aa3}{Message::Type::UNKNOWN}});}
\DoxyCodeLine{00080\ \ \ \ \ \_can\_observer\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_gateway_ab76a33c2110ad476a86c73ed4a265ceb}{Observer}}(c);}
\DoxyCodeLine{00081\ \ \ \ \ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ CRITICAL\ FIX:\ Attach\ observer\ to\ CAN\ bus}}
\DoxyCodeLine{00083\ \ \ \ \ \_can-\/>attach(\_can\_observer,\ c);}
\DoxyCodeLine{00084\ \ \ \ \ }
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ created\ with\ address:\ "{}}\ <<\ addr.to\_string()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_gateway_ac2b912b4419b787d22cbf1044adc9b09}{Gateway::start}}()\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a897a262bdd244180d7aba71cd004b747a067c599a4252b028fe5ee215b368df1c}{TRC}})\ <<\ \textcolor{stringliteral}{"{}Gateway::start()\ called\ for\ ID\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}!\(\backslash\)n"{}};}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_running.load())\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a8a0be1d967a291a31bad4b5fa07afe76ab707f7db5c95d4366940103f50fae3a8}{WRN}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ start()\ called\ but\ already\ running.\(\backslash\)n"{}};}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ \ \ \ \ \_running.store(\textcolor{keyword}{true},\ std::memory\_order\_release);}
\DoxyCodeLine{00095\ \ \ \ \ pthread\_create(\&\_receive\_thread,\ \textcolor{keyword}{nullptr},\ \mbox{\hyperlink{class_gateway_a457ea83a125378da10de5abd808fb84b}{Gateway::mainloop}},\ \textcolor{keyword}{this});}
\DoxyCodeLine{00096\ \ \ \ \ pthread\_create(\&\_internal\_thread,\ \textcolor{keyword}{nullptr},\ \mbox{\hyperlink{class_gateway_a3c27f9d6b08792b882f48d52abd96387}{Gateway::internalLoop}},\ \textcolor{keyword}{this});}
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ threads\ started\(\backslash\)n"{}};}
\DoxyCodeLine{00098\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \textcolor{keyword}{inline}\ \mbox{\hyperlink{class_gateway_a7a86ddccd1e942aa584a4e8c42f82e0b}{Gateway::\string~Gateway}}()\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a897a262bdd244180d7aba71cd004b747a067c599a4252b028fe5ee215b368df1c}{TRC}})\ <<\ \textcolor{stringliteral}{"{}Gateway::\string~Gateway()\ called\ for\ ID\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}!\(\backslash\)n"{}};}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_running.load())\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ \ \ \ \ \_running.store(\textcolor{keyword}{false},\ std::memory\_order\_release);}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \_comms-\/>release();}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{comment}{//\ CRITICAL\ FIX:\ Detach\ observer\ from\ CAN\ bus\ before\ deleting}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_can\_observer)\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}*\ dummy\_msg\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}();}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_condition}{Condition}}\ c(0,\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a696b031073e74bf2cb98e5ef201d4aa3}{Message::Type::UNKNOWN}});}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \_can\_observer-\/>update(c,\ dummy\_msg);}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \_can-\/>detach(\_can\_observer,\ c);}
\DoxyCodeLine{00115\ \ \ \ \ \}}
\DoxyCodeLine{00116\ \ \ \ \ pthread\_join(\_internal\_thread,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keyword}{delete}\ \_can\_observer;}
\DoxyCodeLine{00118\ \ \ \ \ \_can\_observer\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \_network-\/>stop();}
\DoxyCodeLine{00121\ \ \ \ \ pthread\_join(\_receive\_thread,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keyword}{delete}\ \_network;}
\DoxyCodeLine{00123\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a897a262bdd244180d7aba71cd004b747a067c599a4252b028fe5ee215b368df1c}{TRC}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ threads\ joined\(\backslash\)n"{}};}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keyword}{delete}\ \_comms;}
\DoxyCodeLine{00126\ \ \ \ \ }
\DoxyCodeLine{00127\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ destroyed\ successfully\(\backslash\)n"{}};}
\DoxyCodeLine{00128\ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_gateway_adce87b6d4437bf838a96d5c1f49fd00e}{Gateway::send}}(\mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}*\ message)\ \{}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordflow}{if}\ (message-\/>\mbox{\hyperlink{class_message_ac1ea18ca0f925dc5f5ce79a5eca8796f}{size}}()\ >\ \mbox{\hyperlink{class_gateway_ac0b94dec600bdd1c62d3e0cb70218b9d}{MAX\_MESSAGE\_SIZE}})\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a8a0be1d967a291a31bad4b5fa07afe76ab707f7db5c95d4366940103f50fae3a8}{WRN}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ message\ too\ large:\ "{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_ac1ea18ca0f925dc5f5ce79a5eca8796f}{size}}()\ <<\ \textcolor{stringliteral}{"{}\ >\ "{}}\ <<\ \mbox{\hyperlink{class_gateway_ac0b94dec600bdd1c62d3e0cb70218b9d}{MAX\_MESSAGE\_SIZE}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ sending\ external\ message\ of\ type\ "{}}\ <<\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(message-\/>\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}())\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ unit\ "{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_a735ef7d00f8107014facffab3b89f61e}{unit}}()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ Log\ sent\ message\ to\ CSV}}
\DoxyCodeLine{00141\ \ \ \ \ \mbox{\hyperlink{class_gateway_a20131aa2cc26d43572c8ac19629736ee}{log\_message}}(*message,\ \textcolor{stringliteral}{"{}SEND"{}});}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{class_gateway_aa699d63a59873a2fd734ad1589d7bac3}{running}}())\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a8a0be1d967a291a31bad4b5fa07afe76ab707f7db5c95d4366940103f50fae3a8}{WRN}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ send\ called\ but\ gateway\ is\ not\ running\(\backslash\)n"{}};}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00146\ \ \ \ \ \}}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordtype}{bool}\ result\ =\ \_comms-\/>send(message);}
\DoxyCodeLine{00148\ \ \ \ \ }
\DoxyCodeLine{00149\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ external\ send\ result:\ "{}}\ <<\ (result\ ?\ \textcolor{stringliteral}{"{}SUCCESS"{}}\ :\ \textcolor{stringliteral}{"{}FAILED"{}})\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00150\ \ \ \ \ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00152\ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_gateway_a147a0d9f720175e22ff07a9d88062208}{Gateway::receive}}(\mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}*\ message)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_running.load(std::memory\_order\_acquire))\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a8a0be1d967a291a31bad4b5fa07afe76ab707f7db5c95d4366940103f50fae3a8}{WRN}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ receive\ called\ but\ gateway\ is\ not\ running\(\backslash\)n"{}};}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordtype}{bool}\ result\ =\ \_comms-\/>receive(message);}
\DoxyCodeLine{00161\ \ \ \ \ }
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{comment}{//\ Log\ received\ message\ to\ CSV\ if\ successful}}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordflow}{if}\ (result)\ \{}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ received\ external\ message\ of\ type\ "{}}\ <<\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(message-\/>\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}())\ }
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ unit\ "{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_a735ef7d00f8107014facffab3b89f61e}{unit}}()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_gateway_a20131aa2cc26d43572c8ac19629736ee}{log\_message}}(*message,\ \textcolor{stringliteral}{"{}RECEIVE"{}});}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \ \ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00170\ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \textcolor{comment}{//\ TODO\ -\/\ Edit\ origin\ in\ message}}
\DoxyCodeLine{00173\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ Gateway::handle(\mbox{\hyperlink{class_message}{Message}}*\ message)\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ CRITICAL\ FIX:\ Check\ if\ message\ originated\ from\ this\ gateway\ to\ prevent\ feedback\ loop}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{if}\ (message-\/>\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}()\ ==\ \_comms-\/>\mbox{\hyperlink{class_communicator_a6a36e03ee1f2c5778ea859cbf2ab93b0}{address}}())\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ ignoring\ message\ from\ self\ (origin:\ "{}}\ }
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ message-\/>\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}().to\_string()\ <<\ \textcolor{stringliteral}{"{},\ self:\ "{}}\ <<\ \_comms-\/>\mbox{\hyperlink{class_communicator_a6a36e03ee1f2c5778ea859cbf2ab93b0}{address}}().to\_string()\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ \ \ \ \ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{comment}{//\ Validate\ message\ type\ to\ detect\ corruption}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keyword}{auto}\ msg\_type\ =\ message-\/>\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}();}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordflow}{if}\ (msg\_type\ !=\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4ac1833ca6521c2a6c481c6dbe9671738d}{Message::Type::INTEREST}}\ \&\&\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ msg\_type\ !=\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a4fa1a4d2e48aa765093ca6aae57a5150}{Message::Type::RESPONSE}}\ \&\&\ }
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ msg\_type\ !=\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a5f241c8c8f985b3c51e05d39cf030f4c}{Message::Type::STATUS}}\ \&\&}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ msg\_type\ !=\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4ace4e1a7286ff585e08bf30898cf6b3eb}{Message::Type::REQ}}\ \&\&}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ msg\_type\ !=\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a43fc76e7030d9b4f29c4862987a061f4}{Message::Type::KEY\_RESPONSE}})\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a703fe3296c8c842877446fe15f1bddbba0f886785b600b91048fcdc434c6b4a8e}{ERR}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ received\ corrupted\ message\ with\ invalid\ type\ "{}}\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(msg\_type)\ <<\ \textcolor{stringliteral}{"{}\ from\ origin\ "{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}().to\_string()\ }
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ unit="{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_a735ef7d00f8107014facffab3b89f61e}{unit}}()\ <<\ \textcolor{stringliteral}{"{},\ period="{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_ae793e41a6806927dd1f159ec49837508}{period}}().count()\ }
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ value\_size="{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_a7f18843f030797c61e327d63d98e6a4a}{value\_size}}()\ <<\ \textcolor{stringliteral}{"{}\ -\/\ DROPPING\ MESSAGE\(\backslash\)n"{}};}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00193\ \ \ \ \ \}}
\DoxyCodeLine{00194\ \ \ \ \ }
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ handling\ external\ message\ of\ type\ "{}}\ <<\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(message-\/>\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}())\ }
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ unit\ "{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_a735ef7d00f8107014facffab3b89f61e}{unit}}()\ <<\ \textcolor{stringliteral}{"{}\ from\ origin\ "{}}\ <<\ message-\/>\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}().to\_string()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00197\ \ \ \ \ }
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}\ modified\_message\ =\ *message;\ }
\DoxyCodeLine{00200\ \ \ \ \ modified\_message.\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}(\_comms-\/>address());}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{switch}\ (modified\_message.\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}())}
\DoxyCodeLine{00203\ \ \ \ \ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4ac1833ca6521c2a6c481c6dbe9671738d}{Message::Type::INTEREST}}:}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ forwarding\ INTEREST\ to\ CAN\ bus\ with\ modified\ origin\(\backslash\)n"{}};}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \_can-\/>send(\&modified\_message);}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a4fa1a4d2e48aa765093ca6aae57a5150}{Message::Type::RESPONSE}}:}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ forwarding\ RESPONSE\ to\ CAN\ bus\ with\ modified\ origin\(\backslash\)n"{}};}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \_can-\/>send(\&modified\_message);}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a5f241c8c8f985b3c51e05d39cf030f4c}{Message::Type::STATUS}}:}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ forwarding\ STATUS\ to\ CAN\ bus\ with\ modified\ origin\(\backslash\)n"{}};}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \_can-\/>send(\&modified\_message);}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a8a0be1d967a291a31bad4b5fa07afe76ab707f7db5c95d4366940103f50fae3a8}{WRN}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ unknown\ message\ type:\ "{}}\ <<\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(modified\_message.\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}())\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{class_gateway_a457ea83a125378da10de5abd808fb84b}{Gateway::mainloop}}(\textcolor{keywordtype}{void}*\ arg)\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \mbox{\hyperlink{class_gateway_a2c1f64b1635c44121618ba9456302f9f}{Gateway}}*\ self\ =\ \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{class_gateway_a2c1f64b1635c44121618ba9456302f9f}{Gateway}}*\textcolor{keyword}{>}(arg);}
\DoxyCodeLine{00224\ \ \ \ \ }
\DoxyCodeLine{00225\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ self-\/>\_id\ <<\ \textcolor{stringliteral}{"{}]\ external\ receive\ loop\ started\(\backslash\)n"{}};}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{while}\ (self-\/>\mbox{\hyperlink{class_gateway_aa699d63a59873a2fd734ad1589d7bac3}{running}}())\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}\ msg;}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (self-\/>\mbox{\hyperlink{class_gateway_a147a0d9f720175e22ff07a9d88062208}{receive}}(\&msg))\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ self-\/>handle(\&msg);}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \}}
\DoxyCodeLine{00233\ \ \ \ \ }
\DoxyCodeLine{00234\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ self-\/>\_id\ <<\ \textcolor{stringliteral}{"{}]\ external\ receive\ loop\ ended\(\backslash\)n"{}};}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00236\ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_gateway_ae214631a4279aa252fe047db0f3674d1}{Gateway::internalReceive}}(\mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}*\ msg)\ \{}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{comment}{//\ CRITICAL\ FIX:\ Get\ message\ from\ observer\ and\ copy\ it\ to\ the\ parameter}}
\DoxyCodeLine{00240\ \ \ \ \ \mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}*\ received\_msg\ =\ \_can\_observer-\/>updated();}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keywordflow}{if}\ (!received\_msg)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a8a0be1d967a291a31bad4b5fa07afe76ab707f7db5c95d4366940103f50fae3a8}{WRN}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ no\ internal\ message\ received\(\backslash\)n"{}};}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ \ \ \ \ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ received\ message\ to\ the\ output\ parameter}}
\DoxyCodeLine{00247\ \ \ \ \ *msg\ =\ *received\_msg;}
\DoxyCodeLine{00248\ \ \ \ \ }
\DoxyCodeLine{00249\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{}]\ received\ internal\ message\ of\ type\ "{}}\ <<\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(msg-\/>\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}())\ }
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ unit\ "{}}\ <<\ msg-\/>\mbox{\hyperlink{class_message_a735ef7d00f8107014facffab3b89f61e}{unit}}()\ <<\ \textcolor{stringliteral}{"{}\ external:\ "{}}\ <<\ msg-\/>\mbox{\hyperlink{class_message_a5e1b63e51a32c96c04178a30859edbfc}{external}}()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00251\ \ \ \ \ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{comment}{//\ Clean\ up\ the\ received\ message}}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keyword}{delete}\ received\_msg;}
\DoxyCodeLine{00254\ \ \ \ \ }
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00256\ \}}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{class_gateway_a3c27f9d6b08792b882f48d52abd96387}{Gateway::internalLoop}}(\textcolor{keywordtype}{void}*\ arg)\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \mbox{\hyperlink{class_gateway_a2c1f64b1635c44121618ba9456302f9f}{Gateway}}*\ self\ =\ \textcolor{keyword}{reinterpret\_cast<}\mbox{\hyperlink{class_gateway_a2c1f64b1635c44121618ba9456302f9f}{Gateway}}*\textcolor{keyword}{>}(arg);}
\DoxyCodeLine{00260\ \ \ \ \ }
\DoxyCodeLine{00261\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ self-\/>\_id\ <<\ \textcolor{stringliteral}{"{}]\ internal\ receive\ loop\ started\(\backslash\)n"{}};}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordflow}{while}\ (self-\/>\mbox{\hyperlink{class_gateway_aa699d63a59873a2fd734ad1589d7bac3}{running}}())\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}\ msg;}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (self-\/>\mbox{\hyperlink{class_gateway_ae214631a4279aa252fe047db0f3674d1}{internalReceive}}(\&msg))\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CRITICAL\ FIX:\ Check\ if\ message\ originated\ from\ this\ gateway\ to\ prevent\ feedback\ loop}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (msg.\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}()\ ==\ self-\/>\_comms-\/>\mbox{\hyperlink{class_communicator_a6a36e03ee1f2c5778ea859cbf2ab93b0}{address}}()\ ||\ !msg.\mbox{\hyperlink{class_message_a5e1b63e51a32c96c04178a30859edbfc}{external}}())\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ self-\/>\_id\ <<\ \textcolor{stringliteral}{"{}]\ ignoring\ internal\ message\ from\ self\ (origin:\ "{}}\ }
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ msg.\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}().to\_string()\ <<\ \textcolor{stringliteral}{"{},\ self:\ "{}}\ <<\ self-\/>\_comms-\/>\mbox{\hyperlink{class_communicator_a6a36e03ee1f2c5778ea859cbf2ab93b0}{address}}().to\_string()\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ self-\/>\_id\ <<\ \textcolor{stringliteral}{"{}]\ forwarding\ internal\ message\ externally\ from\ origin\ "{}}\ }
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ msg.\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}().to\_string()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ self-\/>\mbox{\hyperlink{class_gateway_adce87b6d4437bf838a96d5c1f49fd00e}{send}}(\&msg);}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00277\ \ \ \ \ \}}
\DoxyCodeLine{00278\ \ \ \ \ }
\DoxyCodeLine{00279\ \ \ \ \ \mbox{\hyperlink{debug_8h_a660fc0a5d907ebe2af475e96bd544090}{db<Gateway>}}(\mbox{\hyperlink{debug_8h_a652e158e58e6fa8494e9137c8dafcf94a2e6059d72d8fde88f3127eb147e4eff8}{INF}})\ <<\ \textcolor{stringliteral}{"{}[Gateway\ "{}}\ <<\ self-\/>\_id\ <<\ \textcolor{stringliteral}{"{}]\ internal\ receive\ loop\ ended\(\backslash\)n"{}};}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00281\ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_gateway_aa699d63a59873a2fd734ad1589d7bac3}{Gateway::running}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{return}\ \_running.load(std::memory\_order\_acquire);}
\DoxyCodeLine{00285\ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \textcolor{keyword}{inline}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{class_gateway_a8870ecac85c6ef2130172409529f3e4b}{Gateway::Address}}\&\ \mbox{\hyperlink{class_gateway_a0cfa8003cefbe287da06a97f6539cd1a}{Gateway::address}}()\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordflow}{return}\ \_comms-\/>address();}
\DoxyCodeLine{00289\ \}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_gateway_a64ff0b83488d7bf17ffc1bb9e439df87}{Gateway::setup\_csv\_logging}}(\textcolor{keyword}{const}\ std::string\&\ log\_dir)\ \{}
\DoxyCodeLine{00292\ \ \ \ \ std::string\ csv\_file\ =\ log\_dir\ +\ \textcolor{stringliteral}{"{}/gateway\_"{}}\ +\ std::to\_string(\_id)\ +\ \textcolor{stringliteral}{"{}\_messages.csv"{}};}
\DoxyCodeLine{00293\ \ \ \ \ std::string\ \mbox{\hyperlink{protocol_8h_ac28f3c5c6696c919222b234f77c85013}{header}}\ =\ \textcolor{stringliteral}{"{}timestamp\_us,message\_type,direction,origin,destination,unit,period\_us,value\_size,latency\_us"{}};}
\DoxyCodeLine{00294\ \ \ \ \ \_csv\_logger\ =\ std::make\_unique<CSVLogger>(csv\_file,\ \mbox{\hyperlink{protocol_8h_ac28f3c5c6696c919222b234f77c85013}{header}});}
\DoxyCodeLine{00295\ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_gateway_a20131aa2cc26d43572c8ac19629736ee}{Gateway::log\_message}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{class_gateway_a238d2852576bf41444ae2a1a84e50d53}{Message}}\&\ msg,\ \textcolor{keyword}{const}\ std::string\&\ direction)\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_csv\_logger\ ||\ !\_csv\_logger-\/>is\_open())\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00299\ \ \ \ \ }
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{keyword}{auto}\ timestamp\_us\ =\ \mbox{\hyperlink{class_message_a6e77e8a3dd4ffc3e33f03e8754d330cd}{Message::getSynchronizedTimestamp}}().count();}
\DoxyCodeLine{00301\ \ \ \ \ }
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{comment}{//\ Calculate\ latency\ for\ received\ messages}}
\DoxyCodeLine{00303\ \ \ \ \ \textcolor{keyword}{auto}\ latency\_us\ =\ 0L;}
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{keywordflow}{if}\ (direction\ ==\ \textcolor{stringliteral}{"{}RECEIVE"{}})\ \{}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ latency\_us\ =\ timestamp\_us\ -\/\ msg.\mbox{\hyperlink{class_message_aae60b766de043dc68bdc455e572d2c19}{timestamp}}().count();}
\DoxyCodeLine{00306\ \ \ \ \ \}}
\DoxyCodeLine{00307\ \ \ \ \ }
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{comment}{//\ Properly\ map\ message\ types\ instead\ of\ assuming\ unknown\ types\ are\ STATUS}}
\DoxyCodeLine{00309\ \ \ \ \ std::string\ msg\_type\_str;}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordflow}{switch}\ (msg.\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}())\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4ac1833ca6521c2a6c481c6dbe9671738d}{Message::Type::INTEREST}}:}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ \ \ msg\_type\_str\ =\ \textcolor{stringliteral}{"{}INTEREST"{}};}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a4fa1a4d2e48aa765093ca6aae57a5150}{Message::Type::RESPONSE}}:}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ \ \ msg\_type\_str\ =\ \textcolor{stringliteral}{"{}RESPONSE"{}};}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a5f241c8c8f985b3c51e05d39cf030f4c}{Message::Type::STATUS}}:}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ msg\_type\_str\ =\ \textcolor{stringliteral}{"{}STATUS"{}};}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4ace4e1a7286ff585e08bf30898cf6b3eb}{Message::Type::REQ}}:}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \ \ msg\_type\_str\ =\ \textcolor{stringliteral}{"{}REQ"{}};}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a43fc76e7030d9b4f29c4862987a061f4}{Message::Type::KEY\_RESPONSE}}:}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \ \ \ \ msg\_type\_str\ =\ \textcolor{stringliteral}{"{}KEY\_RESPONSE"{}};}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4a696b031073e74bf2cb98e5ef201d4aa3}{Message::Type::UNKNOWN}}:}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ msg\_type\_str\ =\ \textcolor{stringliteral}{"{}UNKNOWN"{}};}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{class_message_ad27a1a9986e5a2b019993f6c1d2e77b4accc0377a8afbf50e7094f5c23a8af223}{Message::Type::INVALID}}:}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ msg\_type\_str\ =\ \textcolor{stringliteral}{"{}INVALID"{}};}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \ \ \ \ msg\_type\_str\ =\ \textcolor{stringliteral}{"{}CORRUPTED\_TYPE\_"{}}\ +\ std::to\_string(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(msg.\mbox{\hyperlink{class_message_a24fa33a0be3e5e35f8c7a8a2994659ae}{message\_type}}()));}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00335\ \ \ \ \ \}}
\DoxyCodeLine{00336\ \ \ \ \ }
\DoxyCodeLine{00337\ \ \ \ \ std::ostringstream\ csv\_line;}
\DoxyCodeLine{00338\ \ \ \ \ csv\_line\ <<\ timestamp\_us\ <<\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ msg\_type\_str\ <<\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ direction\ <<\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ (direction\ ==\ \textcolor{stringliteral}{"{}SEND"{}}\ ?\ \mbox{\hyperlink{class_gateway_a0cfa8003cefbe287da06a97f6539cd1a}{address}}().to\_string()\ :\ msg.\mbox{\hyperlink{class_message_aa3290cab595b83a90309002d03379d58}{origin}}().to\_string())\ <<\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ (direction\ ==\ \textcolor{stringliteral}{"{}SEND"{}}\ ?\ \textcolor{stringliteral}{"{}NETWORK"{}}\ :\ \mbox{\hyperlink{class_gateway_a0cfa8003cefbe287da06a97f6539cd1a}{address}}().to\_string())\ <<\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ msg.\mbox{\hyperlink{class_message_a735ef7d00f8107014facffab3b89f61e}{unit}}()\ <<\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ msg.\mbox{\hyperlink{class_message_ae793e41a6806927dd1f159ec49837508}{period}}().count()\ <<\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ msg.\mbox{\hyperlink{class_message_a7f18843f030797c61e327d63d98e6a4a}{value\_size}}()\ <<\ \textcolor{stringliteral}{"{},"{}}}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ latency\_us;}
\DoxyCodeLine{00347\ \ \ \ \ }
\DoxyCodeLine{00348\ \ \ \ \ \_csv\_logger-\/>log(csv\_line.str());}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ GATEWAY\_H}}

\end{DoxyCode}
